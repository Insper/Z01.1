<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
      
        <title>Lab CPU - Elementos de Sistemas</title>
      
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans+Extra+Condensed:700|Oxygen+Mono|Source+Sans+Pro:700|Source+Serif+Pro&amp;display=swap">
    <link rel="stylesheet" href="../../assets/css/main.css">
    <script>
      // SETUP GLOBAL CONSTANTS
      var base_url = '../..';
      
      var telemetryEnabled = true;
      var backendUrl = "https://devlife-api.insper-comp.com.br/";
      var courseSlug = "25b-ele";
      
      
      var dashboardEnabled = false;
      var tagTree = {};
      

      // SETUP PLUGIN
      window.initialized = false;
      if (!window.initializers) window.initializers = [];
      window.registerInitializer = (initialize) => {
        if (window.initialized) initialize();
        else window.initializers.push(initialize);
      };
    </script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          processEscapes: true
        }
      });
    </script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="https://unpkg.com/hyperscript.org"></script>
    <script src="https://unpkg.com/htmx.org@1.8.4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="../../assets/js/main.js"></script>
    
    <link rel="stylesheet" href="../../termynal.css">
  <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
        </style></head>
  <body>
    <div class="ah-main-container">
      <header class="ah-header">
        <button class="ah-menu-btn ah-button ah-button--borderless" aria-label="toggle menu">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
  <!--! Font Awesome Pro 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
  <path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"></path>
</svg>
        </button>
        <a href="../.." title="Elementos de Sistemas" class="ah-logo" aria-label="Elementos de Sistemas">
          Elementos de Sistemas
        </a>
        <div class="ah-header--right">
          
          
          
          <button id="resetHandoutButton">
            <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">
  <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"></path>
</svg></span>
          </button>
          

          
          <div id="user-menu" hx-get="https://devlife-api.insper-comp.com.br/user-menu" hx-trigger="load"> </div>
          
        </div>
      </header>
      <nav class="ah-navigation preload">
        <div class="ah-nav-container">
          <button class="ah-menu-btn ah-button ah-button--borderless close-menu" aria-label="close menu">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
  <!--! Font Awesome Pro 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
  <path d="M310.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160 210.7 54.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L114.7 256 9.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 301.3 265.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L205.3 256 310.6 150.6z"></path>
</svg>
          </button>
          <ul class="ah-nav-body">
            
              
  
    <li>
      <a href="../..">Home</a>
    </li>
  

            
              
  
    <li>
      <a href="../../Home/Avaliacoes-Informacoes/">Avaliação</a>
    </li>
  

            
              
  <li class="ah-togglable-item opened">
    <span class="ah-togglable-handle">Aulas</span>
    <ul>
      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Fevereiro</span>
    <ul>
      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">11/02 - Organização</span>
    <ul>
      
        
  
    <li>
      <a href="../..">Home</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">13/02 - Dados digitais</span>
    <ul>
      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-Dados/">Leitura Prévia</a>
    </li>
  

      
        
  
    <li>
      <a href="https://github.com/Insper/Z01.1/blob/main/Exercicios/Dados_1.pdf">Exercícios 1</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Exercicios/Exercicio-Dados-2/">Exercícios 2</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">20/02 - Aritmética</span>
    <ul>
      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-Aritmetica-Binaria/">Leitura Prévia</a>
    </li>
  

      
        
  
    <li>
      <a href="https://github.com/Insper/Z01.1/blob/master/Exercicios/Exercicio-Aritmetica-Booleana.pdf">Exercícios 1</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab1.1-Ambiente/">Lab - Github grupo</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab1.2-Ambiente/">Lab - Github individual</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">25/02 - Álgebra</span>
    <ul>
      
        
  
    <li>
      <a href="../../Teoria/Teoria-Algebra-Booleana/">Leitura Prévia</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Exercicios/Exercicio-Algebra-Booleana-1/">Exercícios 1</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Exercicios/Exercicio-Algebra-Booleana-2/">Exercícios 2</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Projetos/A-Algebra-CIs/">APS-A - Início</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">27/02 - Transistores</span>
    <ul>
      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-CMOS/">Leitura Prévia - 1</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-RTL/">Leitura Prévia - 2</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab2-A-Transistores-CI/">Lab - CIs</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Projetos/A-Algebra-CIs/">APS-A - Início</a>
    </li>
  

      
    </ul>
  </li>

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Março</span>
    <ul>
      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">06/03 - VHDL</span>
    <ul>
      
        
  
    <li>
      <a href="../../VHDL/VHDL-basico/">Leitura Prévia - VHDL</a>
    </li>
  

      
        
  
    <li>
      <a href="../../VHDL/VHDL-Combinacional/">VHDL Combinacional</a>
    </li>
  

      
        
  
    <li>
      <a href="../../VHDL/VHDL-port-map/">VHDL Port Map</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab3-LogiComb-FPGA/">Lab FPGA</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">11/03 - Componentes digitais</span>
    <ul>
      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-Componentes/">Leitura Prévia</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab4-LogiComb/">Lab Lógica Combinacional</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Projetos/B-LogiComb/">APS-B</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">13/03 - Formas de ondas</span>
    <ul>
      
        
  
    <li>
      <a href="../Lab6-Waves/">Lab Formas de Ondas</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Projetos/B-LogiComb/">APS-B</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">18/03 - Aritmética HW</span>
    <ul>
      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-Aritmetica-Binaria-HW/">Leitura Prévia</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab5-Adder/">Lab Adder</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Projetos/C-ula/">APS-C</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">20/03 - ULA</span>
    <ul>
      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-ULA/">Leitura Prévia</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab7-ULA/">Lab ULA</a>
    </li>
  

      
        
  
    <li>
      <a href="https://renan-tr.github.io/simulador/ula">Simulador ULA</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Projetos/C-ula/">APS-C</a>
    </li>
  

      
    </ul>
  </li>

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item opened">
    <span class="ah-togglable-handle">Abril</span>
    <ul>
      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">08/04 - Lógica Sequencial</span>
    <ul>
      
        
  
    <li>
      <a href="../../Teoria/Teoria-Logica-Sequencial/">Leitura Prévia</a>
    </li>
  

      
        
  
    <li>
      <a href="../../VHDL/VHDL-Sequencial/">VHDL Sequencial</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab8-Seq/">Lab Lógica Sequencial</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Projetos/D-LogSeq/">APS-D</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">10/04 - Componentes sequenciais</span>
    <ul>
      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-Sequencial-Componentes/">Leitura Prévia</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Projetos/D-LogSeq/">APS-D</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">15/04 - Linguagem de Máquina</span>
    <ul>
      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-Linguagem-de-Maquina/">Leitura Prévia</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/z01/z01-InstructionSet/">Instruction Set</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item opened">
    <span class="ah-togglable-handle">17/04 - CPU</span>
    <ul>
      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-Z01/">Leitura Prévia</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Exercicios/Exercicio-CPU-1/">Exercícios 1</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Exercicios/Exercicio-CPU-2/">Exercícios 2</a>
    </li>
  

      
        
  

    <li class="active ah-togglable-item opened">
      <span class="ah-togglable-handle">Lab CPU</span>
      <ul>
        
          
            
            
              <li class="ah-toc-item">
                <a href="#controlunit">ControlUnit</a>
              </li>
            
              <li class="ah-toc-item">
                <a href="#memory-io">Memory IO</a>
              </li>
            
              <li class="ah-toc-item">
                <a href="#cpu">CPU</a>
              </li>
            
              <li class="ah-toc-item">
                <a href="#extras">Extras</a>
              </li>
            
        
      </ul>
    </li>
  

      
        
  
    <li>
      <a href="../../Projetos/E-CPU/">APS-E</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">22/04 - CPU na FPGA</span>
    <ul>
      
        
  
    <li>
      <a href="../Lab10.2-CPU-FPGA/">Programando na FPGA</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Projetos/E-CPU/">APS-E</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">24/04 - Assembly</span>
    <ul>
      
        
  
    <li>
      <a href="../../Teoria/Teoria-Assembly/">Leitura Prévia</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/z01/z01-Resumo-Assembly/">Resumo Assembly</a>
    </li>
  

      
        
  
    <li>
      <a href="https://renan-tr.github.io/simulador/assembly">Assembly Online Simulator</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">29/04 - Assembly Saltos</span>
    <ul>
      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-Z01-mapadeMemoria/">Leitura Prévia - memória</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-nasm-jump/">Leitura Prévia - saltos</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab12-Assembly/">Lab Assembly - parte 1</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab13-Assembly/">Lab Assembly - parte 2</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Projetos/F-Assembly/">APS-F</a>
    </li>
  

      
    </ul>
  </li>

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Maio</span>
    <ul>
      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">06/05 - memória</span>
    <ul>
      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-Z01-mapadeMemoria/">Leitura Prévia - memória</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-nasm-jump/">Leitura Prévia - saltos</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab14-Assembly/">Lab Assembly - parte 3</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Projetos/F-Assembly/">APS-F</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">08/05 - prática assembly</span>
    <ul>
      
        
  
    <li>
      <a href="../Lab15-Assembly-FPGA/">Lab Assembly FPGA</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Projetos/F-Assembly/">APS-F</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">13/05 - VM</span>
    <ul>
      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-vm/">Leitura Prévia - VM</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/z01/z01-Resumo-VM/">Resumo VM</a>
    </li>
  

      
        
  
    <li>
      <a href="https://renan-tr.github.io/simulador/vm">VM Online Simulator</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">15/05 - VM funções</span>
    <ul>
      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-vm-segmentos/">Leitura Prévia - Segmentos</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-vm-memoria/">Leitura Prévia - Memória</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">20/05 - VMtranslator</span>
    <ul>
      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Lab VMtranslator</span>
    <ul>
      
        
  
    <li>
      <a href="../Lab14.1-VMtranslator/">Lab14.1 VMtranslator</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab14.2-VMtranslator/">Lab14.2 VMtranslator</a>
    </li>
  

      
    </ul>
  </li>

      
        
  
    <li>
      <a href="../../Projetos/I-VMtranslator/">APS-G</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">22/05 - VMtranslator</span>
    <ul>
      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-vm-jump/">Leitura Prévia - saltos</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-vm-funcoes/">Leitura Prévia - funções</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Teoria/VMtranslator-memoria/">Leitura Prévia - memória</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab15-VM/">Lab VM</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Projetos/I-VMtranslator/">APS-G</a>
    </li>
  

      
    </ul>
  </li>

      
    </ul>
  </li>

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Útil</span>
    <ul>
      
        
  
    <li>
      <a href="../../Util/Util-Dicas-GIT/">Dicas git</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Util/Util-Comecando-novo-projeto/">Novo projeto (a partir da APS-C)</a>
    </li>
  

      
        
  
    <li>
      <a href="https://renan-tr.github.io/simulador/ula">Simulador ULA</a>
    </li>
  

      
        
  
    <li>
      <a href="https://renan-tr.github.io/simulador/assembly">Assembly Online Simulator</a>
    </li>
  

      
        
  
    <li>
      <a href="https://renan-tr.github.io/simulador/vm">VM Online Simulator</a>
    </li>
  

      
    </ul>
  </li>

            
          </ul>
        </div>
      </nav>
      <main class="ah-content ah-typeset">
        
          <div class="ah-title-box">
            <ul class="ah-breadcrumbs">
              
                
                  
                    <li>Aulas</li>
                  
                
                  
                    <li>Abril</li>
                  
                
                  
                    <li>17/04 - CPU</li>
                  
                
                <li></li>
            </ul>
            
            
          </div>
          
            <section class="progress-section show">
<h1 id="lab-control-unit">Lab: Control Unit</h1>
<div class="admonition warning">
<p class="admonition-title">Antes de começar</p>
<!-- Aqui começa o projeto **F-CPU**. ==Vocês devem escolher um novo Mediador== -->
<p>Toda vez que um novo projeto começar será necessário realizar algumas configurações no repositório do grupo, vocês devem seguir para o documento: <a href="https://insper.github.io/Z01.1/Util/Util-Comecando-novo-projeto/"><code>Util/Começando novo Projeto</code></a> e depois voltar para esse lab.</p>
<ul>
<li>Não seguir sem realizar a etapa anterior.</li>
</ul>
</div>
<p>A unidade de controle é o periférico da CPU responsável por decodificar uma instrução (linguagem de máquina) e realizar as modificações necessárias no HW (mux, load, ULA, registradores, PC) a fim de executar tal operação.</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../figs/G-CPU/controlUnit.svg" data-desc-position="bottom"><img alt="" src="../../figs/G-CPU/controlUnit.svg" width="60%"></a></p>
<p>O <code>control unit</code> controla todos os componentes internos da nossa CPU, é ele que por exemplo seleciona como vai estar os sinais do seletor dos mux (<code>muxALUI/I</code>/<code>muxAM/D</code>, qual operação a ULA irá executar (<code>zr.nx.zy.ny.f.no</code>), onde o dado será salvo (<code>loadD</code>, <code>loadA</code>, <code>writeM</code>, <code>loadPC</code>) e se é para executar uma operação de salto (<code>loadPC</code>). </p>
<p>A figura a baixo ilustra tudo que o <mark>control unit controla</mark>.</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../figs/G-CPU/cpu-cu.svg" data-desc-position="bottom"><img alt="" src="../../figs/G-CPU/cpu-cu.svg"></a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note que os sinais do comparador da ULA: <code>zr</code> e <code>ng</code> também vão para a unidade de controle. É a partir do valor deles que o hardware decide se vai ou não ocorrer uma operação de salto.</p>
</div>
<h2 id="controlunit">ControlUnit</h2>
<p>Vamos implementar partes da unidade de controle. </p>
<h3 id="loadd-exemplo"><code>loadD</code> (exemplo)</h3>
<div class="admonition example">
<p>Exemplo!</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip 1</p>
<p>Utilize o documento <a href="https://insper.github.io/Z01.1/Z01/Util-InstructionSet/"><code>Z01/Instruction Set</code></a> para resolver esse lab.</p>
</div>
<p>O sinal <code>loadD</code> indica quando o registrador <code>D</code> deve armazenar um novo sinal. Para isso, devemos verificar se a instrução em questão que está sendo decodificada pelo 'controlUnit' é do tipo <strong>comando</strong> (C), essa verificação é feita pelo bit mais significativo da instrução (<code>bit17</code>).</p>
<p>Uma vez que detectado uma instrução do tipo C, devemos verificar se o comando que ela representa carrega a operação de salvar em <code>%D</code>, verificamos isso pelo bit <code>d1</code>, que indica se irá ou não ocorrer um carregamento em <code>%D</code>.</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../figs/G-CPU/loadD.svg" data-desc-position="bottom"><img alt="" src="../../figs/G-CPU/loadD.svg"></a></p>
<p>Com esses dados conseguimos criar a tabela verdade a seguir e extrair a equação que rege esse sinal.</p>
<table>
<thead>
<tr>
<th><code>bit 17</code></th>
<th><code>bit 4</code></th>
<th><code>loadD</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>X</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td><mark>1</mark></td>
<td><mark>1</mark></td>
<td><mark>1</mark></td>
</tr>
</tbody>
</table>
<p>Podendo ser traduzido para o código em VHDL (via soma dos produtos):</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="n">loadD</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">instruction</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">instruction</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</code></pre></div>
<blockquote>
<p>Nesse lab iremos fazer parte do ControlUnit, ele não deve passar em todos os testes.</p>
</blockquote>
<div class="admonition example">
<p class="admonition-title">Implementando e testando</p>
<ol>
<li>Abra o arquivo <code>/e_CPU/src/controlUnit.vhd</code></li>
<li>Insira a implementação anterior do <code>loadD</code> na arquitetura</li>
</ol>
</div>
<h3 id="loadm"><code>loadM</code></h3>
<p>Vamos agora implementar o sinal <code>loadM</code>, esse sinal é o que controla se irá ocorrer uma operação de escrita na memória RAM.</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../figs/G-CPU/cpu-writeM.svg" data-desc-position="bottom"><img alt="" src="../../figs/G-CPU/cpu-writeM.svg" width="300"></a></p>
<div class="admonition example">
<p class="admonition-title">Implementando e testando</p>
<ol>
<li>Entenda os bits envolvidos</li>
<li>Escreva uma tabela verdade</li>
<li>Encontre a equação e implemente no <code>controlUnit.vhd</code></li>
</ol>
</div>
<h3 id="loada"><code>loadA</code></h3>
<p>Agora implemente o <code>loadA</code>, esse sinal que controla o load do registrador A.</p>
<div class="admonition example">
<p class="admonition-title">Implementando e testando</p>
<ol>
<li>Entenda os bits envolvidos</li>
<li>Escreva uma tabela verdade</li>
<li>Encontre a equação e implemente no <code>controlunit.vhd</code></li>
</ol>
</div>
<!--
    1. Teste com o comando `pytest -k controlunit`
       - Deve passar nos 7 primeiros testes e, então, apresentar erro.
-->

<h3 id="muxalui_a"><code>muxALUI_A</code></h3>
<p>Esse sinal (<code>muxALUI_A</code>) controla o mux que seleciona qual o sinal que entra no registrador <code>%A</code>, a entrada <code>0</code> do mux é o sinal que sai da ULA e o sinal <code>1</code> do mux são os bits [15..0] da instrução. </p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../figs/G-CPU/cpu-muxALUI.svg" data-desc-position="bottom"><img alt="" src="../../figs/G-CPU/cpu-muxALUI.svg" width="300"></a></p>
<div class="admonition tip">
<p class="admonition-title">Tip 2</p>
<p>Com esse sinal implementando, nossa CPU já suporta a instrução <code>leaw $x, %A</code></p>
</div>
<div class="admonition example">
<p class="admonition-title">Implementando e testando</p>
<ol>
<li>Entenda os bits envolvidos</li>
<li>Escreva uma tabela verdade</li>
<li>Encontre a equação e implemente no <code>controlunit.vhd</code></li>
</ol>
</div>
<!--
    1. Teste com o comando `./testeHW.py`
       - Deve passar no ==TESTE 7== e ==TESTE 8==
       - Deve parar para no ==TESTE 9==
-->

<h3 id="zx"><code>zx</code></h3>
<p>Agora faça o sinal <code>zx</code> que controla o zerador do sinal x da ULA.</p>
<div class="admonition example">
<p class="admonition-title">Implementando e testando</p>
<ol>
<li>Entenda os bits envolvidos</li>
<li>Escreva uma tabela verdade</li>
<li>Encontre a equação e implemente no <code>controlunit.vhd</code></li>
</ol>
</div>
<!--
    1. Teste com o comando `./testeHW.py`
       - Deve passar no ==TESTE 9== e ==TESTE 10==
       - Deve parar para no ==TESTE 11==
-->

<h2 id="memory-io">Memory IO</h2>
<p>O componente <code>memory IO</code> é a 'memória' do nosso computador. Interno nesse módulo possuímos além da memória RAM, outros componentes tais como: tela, chave, leds. Lembrando que para a CPU, não existe separação entre o que é memória e o que é periférico. </p>
<p>Os periféricos internos do <code>memoryIO</code> são:</p>
<ul>
<li>Tela (<code>screen.vhd</code>)<ul>
<li>responsável por controlar o LCD </li>
</ul>
</li>
<li>RAM (<code>ram16k.vhd</code>)<ul>
<li>memória RAM de 16k endereços</li>
</ul>
</li>
<li>SW<ul>
<li>chaves da FPGA</li>
</ul>
</li>
<li>LED<ul>
<li>LEDs da FPGA</li>
</ul>
</li>
</ul>
<p><code>screen</code> e <code>ram16k</code> possuem a interface detalhada a seguir:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../figs/G-CPU/memoryIO.svg" data-desc-position="bottom"><img alt="" src="../../figs/G-CPU/memoryIO.svg"></a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Os sinais do tipo <code>LCD_</code> da <code>screen</code> são conectados diretamente ao LCD, via <code>portmap</code>.</p>
</div>
<p>O componente <code>memoryIO</code> possui a seguinte entidade:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../figs/G-CPU/memoryio-entidade.png" data-desc-position="bottom"><img alt="" src="../../figs/G-CPU/memoryio-entidade.png" width="200"></a></p>
<h3 id="estudando">Estudando!</h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Discuta, pense e escreva a solução antes de ver a resposta.</p>
</div>
<ol>
<li>
<p>Pense e discuta com seus colegas o <code>memoryIO</code>.</p>
</li>
<li>
<p>Dos sinais de entrada do <code>memoryIO</code> qual define qual periférico (RAM/LCD/SW/LED) será acessado pela CPU? Explique.</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<details class="info">
<summary>Resposta</summary>
<p>O sinal em questão é o <code>address</code>, pois os periféricos são mapeados em endereços diferentes, e é esse sinal que define qual periférico a CPU está querendo acessar. Exemplo: se o sinal <code>address = 1024</code>, a CPU está realizando uma operação na memória RAM, mas se o sinal <code>address = 21184</code> isso indica que a CPU está querendo acessar o <code>LED</code>.</p>
<ul>
<li>Para mais informações, leia <a href="https://insper.github.io/Z01.1/commum-content/teoria/Teoria-Z01-mapadeMemoria/">Teoria/Z01 - Mapa de Memória</a>.</li>
</ul>
</details>
<ol>
<li>Qual sinal informa o <code>memoryIO</code> que a CPU está realizando uma escrita?</li>
</ol>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<details class="info">
<summary>Resposta</summary>
<p>É o <code>writeM</code>, se <code>1</code> indica que a CPU quer realizar uma escrita, caso contrário é uma leitura.</p>
</details>
<ol>
<li>Quais são suas entradas e saídas do LCD que o memoryIO controla? (tudo tirando o que começa com <strong>LCD_</strong>)</li>
</ol>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<details class="info">
<summary>Resposta</summary>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="n">DISPLAY</span><span class="o">:</span><span class="w"> </span><span class="n">Screen</span><span class="w">  </span><span class="k">port</span><span class="w"> </span><span class="k">map</span><span class="w"> </span><span class="p">(</span>
<span class="w">         </span><span class="n">RST</span><span class="w">          </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">RST</span><span class="p">,</span>
<span class="w">         </span><span class="n">CLK_FAST</span><span class="w">     </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">CLK_FAST</span><span class="p">,</span>
<span class="w">         </span><span class="n">CLK_SLOW</span><span class="w">     </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">CLK_SLOW</span><span class="p">,</span>

<span class="w">         </span><span class="n">INPUT</span><span class="w">        </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">INPUT</span><span class="p">,</span>
<span class="w">         </span><span class="n">LOAD</span><span class="w">         </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">LOAD_DISPLAY</span><span class="p">,</span>
<span class="w">         </span><span class="n">ADDRESS</span><span class="w">      </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">ADDRESS</span><span class="p">(</span><span class="mi">13</span><span class="w"> </span><span class="k">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span>
<span class="w">         </span><span class="n">LCD_INIT_OK</span><span class="w">  </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">LCD_INIT_OK</span><span class="p">,</span>

<span class="w">         </span><span class="n">LCD_CS_N</span><span class="w">     </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">LCD_CS_N</span><span class="w"> </span><span class="p">,</span>
<span class="w">         </span><span class="n">LCD_D</span><span class="w">        </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">LCD_D</span><span class="p">,</span>
<span class="w">         </span><span class="n">LCD_RD_N</span><span class="w">     </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">LCD_RD_N</span><span class="p">,</span>
<span class="w">         </span><span class="n">LCD_RESET_N</span><span class="w">  </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">LCD_RESET_N</span><span class="p">,</span>
<span class="w">         </span><span class="n">LCD_RS</span><span class="w">       </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">LCD_RS</span><span class="p">,</span>
<span class="w">         </span><span class="n">LCD_WR_N</span><span class="w">     </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">LCD_WR_N</span>
<span class="p">);</span>
</code></pre></div>
<ul>
<li><code>input</code>: são os px a serem escritos</li>
<li><code>load</code>: se é para atualizar os px</li>
<li><code>adddress</code>: quais px serão escritos</li>
</ul>
<p>Note que esses sinais são os mesmos sinais de uma memória RAM, porém sem a parte de leitura. O LCD como foi implementando, não suporta que realizemos a leitura de seus pxs.</p>
</details>
<ol>
<li>Como funciona o LED?</li>
</ol>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<details class="info">
<summary>Resposta</summary>
<p>O LED é um endereço da memória, como ele 'armazena' o dado, deve ser implementando com um registrador.</p>
</details>
<ol>
<li>Faça um esboço (diagrama) de como o <code>memoryIO</code> implementará a saída <code>LED</code> </li>
</ol>
<div class="highlight"><pre><span></span><code>         |                                                          |
   LOAD  ---&gt;                                                       |
   ADDRESS -&gt;                                                       |
   INPUT ---&gt;                                                       |
         |                                                          ---&gt; LED
         |                                                          |
         |                                                          |
         |                                                          |
         |                                                          |
</code></pre></div>
<p>Pinos do <code>memoryIO</code>:</p>
<ul>
<li>LOAD: indica escrita</li>
<li>ADDRESS(16 downto 0): endereço da escrita</li>
<li>INPUT(16 downto 0): dado a ser escrito </li>
<li>LED(9 downto 0): Valor dos LEDs da FPGA</li>
</ul>
<h2 id="cpu">CPU</h2>
<p>Proponha uma modificação na <code>CPU</code> do nosso Z01.1 que:</p>
<ol>
<li>Adiciona mais um registrador (<code>%S</code>) (onde é melhor?)</li>
<li>Você teria que modificar a linguagem de máquina do nosso HW. Proponha uma solução.</li>
<li>Possibilita %D endereçar a memória <ul>
<li><code>movw %A, (%D)</code></li>
</ul>
</li>
<li>Possibilite fazer carregamento efetivo em %D<ul>
<li><code>leaw $5, %D</code></li>
</ul>
</li>
</ol>
<p>Para cada modificação faça o desenho da nova CPU.</p>
<h2 id="extras">Extras</h2>
<h3 id="nop"><code>nop</code></h3>
<p>Como o controlUnit controla a CPU para realizar a operação de NOP?</p>
<h3 id="movw-d-a-e-jg-d-ao-mesmo-tempo"><code>movw %D, %A e jg %D</code> ao mesmo tempo</h3>
<p>Nossa CPU suportaria executar simultaneamente a instrução <code>movw %D, %A</code> e ao mesmo tempo a instrução <code>jg %D</code>? </p>
<h3 id="loadpc"><code>loadPC</code></h3>
<p>Quais sinais o influenciam?</p>


</section>
          
        
      </main>
      <footer class="ah-footer ah-typeset">
        <div class="ah-footer-nav">
          
            <a href="../../Exercicios/Exercicio-CPU-2/" class="ah-prev" title="Exercícios 2">
              <span class="nav-label">Previous</span>
              <span class="nav-title">Exercícios 2</span>
            </a>
          
          
            <a href="../../Projetos/E-CPU/" class="ah-next" title="APS-E">
              <span class="nav-label">Next</span>
              <span class="nav-title">APS-E</span>
            </a>
          
        </div>
      </footer>
    </div>
    
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script src="../../termynal.js"></script>
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
</script></body></html>